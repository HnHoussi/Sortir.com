{% extends 'base.html.twig' %}

{% block title %}Liste des utilisateurs{% endblock %}

{% block body %}
    <h1 class="text-center mb-5">üë• Utilisateurs inscrits</h1>
    <div class="d-flex justify-content-center mb-5">
        <a href="{{ path('admin_user_add') }}" class="btn btn-success">
            Ajouter un utilisateur
        </a>
        <a href="{{ path('admin_user_import') }}" class="btn btn-secondary mx-2">
            Ajouter des utilisateurs via CSV
        </a>

    </div>


    <div class="container mt-4 d-flex justify-content-center">
        <div class="table-responsive w-75">

            <table id="usersTable" class="table table-bordered table-hover align-middle text-nowrap text-center">
                <thead class="table-dark">
                <tr>
                    <th class="text-center">Nom</th>
                    <th class="text-center">T√©l√©phone</th>
                    <th class="text-center">R√¥le</th>
                    <th class="text-center">Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for user in users %}
                    <tr>
                        <td>{{ user.firstName }} {{ user.lastName }}</td>
                        <td>{{ user.phone ?: '‚Äî' }}</td>
                        <td>
                            {% if 'ROLE_ADMIN' in user.roles %}
                                <span class="badge bg-danger">Admin</span>
                            {% else %}
                                <span class="badge bg-secondary">Invit√©</span>
                            {% endif %}
                        </td>
                        <td class="d-flex gap-2 justify-content-center">
                            <a href="{{ path('user_detail', {'id': user.id}) }}" class="btn btn-sm btn-outline-primary">
                                D√©tails
                            </a>

                            {% set canEditDelete = user.isActive and 'ROLE_ADMIN' not in user.roles %}

                            {% if canEditDelete %}
                                <a href="{{ path('admin_edit_user', {id: user.id}) }}" class="btn btn-warning btn-sm">Modifier</a>
                                <a href="{{ path('admin_user_delete', {id: user.id}) }}" class="btn btn-danger btn-sm"
                                   onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cet utilisateur ?');">Supprimer</a>
                            {% else %}
                                <button class="btn btn-warning btn-sm" disabled>Modifier</button>
                                <button class="btn btn-danger btn-sm" disabled>Supprimer</button>
                            {% endif %}
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="7" class="text-center">Aucun utilisateur trouv√©.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {# DataTables & jQuery #}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#usersTable').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/fr-FR.json',
                    search: "Rechercher :",         // Search label
                    lengthMenu: "Afficher _MENU_ r√©sultats par page", // Length menu
                    paginate: {
                        first: "Premi√®re",
                        last: "Derni√®re",
                        next: "Suivante",
                        previous: "Pr√©c√©dente"
                    },
                    zeroRecords: "Aucun enregistrement trouv√©",
                    infoEmpty: "Aucun utilisateur disponible"
                },
                pageLength: 5,
                lengthMenu: [5, 10, 25, 50],
                order: [[0, 'asc']],
                info: false,
                dom:
                    "<'row mb-3'<'col-sm-6'l><'col-sm-6'f>>" +
                    "<'row'<'col-12'tr>>" +
                    "<'row mt-3'<'col-12 d-flex justify-content-center'p>>"
            });

            // Style the search input
            $('#usersTable_filter input').addClass('form-control').css({
                'width': '200px',
                'display': 'inline-block'
            });

            // Style the length selector
            $('#usersTable_length select').addClass('form-select').css({
                'width': '80px',
                'display': 'inline-block'
            });
        });
    </script>



{% endblock %}
